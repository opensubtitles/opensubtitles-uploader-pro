<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Tauri Drag Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: monospace;
            background: #f0f0f0;
        }
        
        #drop-zone {
            width: 600px;
            height: 400px;
            border: 3px dashed #007acc;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #007acc;
            margin: 20px auto;
        }
        
        #drop-zone.drag-over {
            background: #e7f3ff;
            border-color: #0056b3;
        }
        
        #log {
            background: black;
            color: lime;
            padding: 20px;
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>🎯 Simple Tauri Drag & Drop Test</h1>
    
    <div id="drop-zone">
        DRAG FILES HERE
    </div>
    
    <div id="log"></div>
    
    <script>
        const dropZone = document.getElementById('drop-zone');
        const logDiv = document.getElementById('log');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `${timestamp}: ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`🎯 ${message}`);
        }
        
        log('🚀 Simple drag test loaded');
        log(`Protocol: ${window.location.protocol}`);
        log(`User agent: ${navigator.userAgent}`);
        
        // Check if we're in Tauri
        const isTauri = window.location.protocol === 'tauri:';
        log(`Tauri environment: ${isTauri}`);
        
        if (isTauri) {
            log('🔧 Setting up Tauri drag handlers...');
            
            // Try to import Tauri event API
            setTimeout(async () => {
                try {
                    log('Attempting to import @tauri-apps/api/event...');
                    const { listen } = await import('@tauri-apps/api/event');
                    log('✅ Tauri event API imported successfully');
                    
                    // Set up Tauri file drop listeners
                    await listen('tauri://file-drop', (event) => {
                        log(`🎯 TAURI FILE DROP: ${event.payload.length} files`);
                        log(`Files: ${event.payload.join(', ')}`);
                        dropZone.style.background = '#d4edda';
                        dropZone.innerHTML = `RECEIVED ${event.payload.length} FILES!`;
                    });
                    
                    await listen('tauri://file-drop-hover', (event) => {
                        log('🎯 TAURI FILE HOVER');
                        dropZone.classList.add('drag-over');
                    });
                    
                    await listen('tauri://file-drop-cancelled', (event) => {
                        log('🎯 TAURI FILE DROP CANCELLED');
                        dropZone.classList.remove('drag-over');
                    });
                    
                    log('✅ Tauri file drop events registered');
                    dropZone.innerHTML = 'TAURI READY - DRAG FILES HERE';
                    
                } catch (error) {
                    log(`❌ Tauri event import failed: ${error.message}`);
                    log(`Error details: ${JSON.stringify(error)}`);
                    setupDOMFallback();
                }
            }, 1000);
            
        } else {
            log('🌐 Browser environment - setting up DOM handlers');
            setupDOMFallback();
        }
        
        function setupDOMFallback() {
            log('🔄 Setting up DOM drag handlers as fallback');
            
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.stopPropagation();
                dropZone.classList.add('drag-over');
                log('DOM: dragover');
            });
            
            dropZone.addEventListener('dragleave', (e) => {
                e.preventDefault();
                e.stopPropagation();
                dropZone.classList.remove('drag-over');
                log('DOM: dragleave');
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                e.stopPropagation();
                dropZone.classList.remove('drag-over');
                
                const files = Array.from(e.dataTransfer.files);
                log(`DOM: drop - ${files.length} files`);
                
                files.forEach(file => {
                    log(`File: ${file.name} (${file.size} bytes)`);
                });
                
                dropZone.style.background = '#d4edda';
                dropZone.innerHTML = `DOM RECEIVED ${files.length} FILES!`;
            });
            
            log('✅ DOM drag handlers ready');
            dropZone.innerHTML = 'DOM READY - DRAG FILES HERE';
        }
    </script>
</body>
</html>